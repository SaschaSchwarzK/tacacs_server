<!-- Authentication Backends -->
<div class="card config-section">
  <div class="section-header"><h2 class="section-title">Authentication Backends</h2></div>
  
  <div class="subsection">
    <div class="subsection-header">General Settings</div>
    <form id="auth-form" onsubmit="return false;" class="form-grid">
      <div class="form-field">
        <label for="auth_backends">Backends</label>
        <div class="input-wrapper">
          <input type="text" id="auth_backends" name="backends" value="{{ (configuration.get('auth') or {}).get('backends','') }}" />
          <span class="field-hint">Comma-separated (local,ldap,okta,radius)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="auth_local_db">Local Auth DB</label>
        <div class="input-wrapper">
          <input type="text" id="auth_local_db" name="local_auth_db" value="{{ (configuration.get('auth') or {}).get('local_auth_db','') }}" />
          <span class="field-hint">Database path</span>
        </div>
      </div>
      <div class="form-field">
        <label for="auth_require_all">Require All</label>
        <div class="input-wrapper">
          <select id="auth_require_all" name="require_all_backends">
            {% set require_all = ((configuration.get('auth') or {}).get('require_all_backends','false') | string).lower() %}
            <option value="false" {% if require_all=='false' %}selected{% endif %}>No</option>
            <option value="true" {% if require_all=='true' %}selected{% endif %}>Yes</option>
          </select>
          <span class="field-hint">All backends must succeed</span>
        </div>
      </div>
    </form>

    <div>
      <label class="toggle-switch">
        <input type="checkbox" id="toggle-auth-advanced" onchange="toggleSection('auth-advanced')" />
        <span>Show Advanced Settings</span>
      </label>
      <div id="auth-advanced" class="advanced-settings">
        <form id="auth-advanced-form" onsubmit="return false;" class="form-grid">
          <div class="form-field">
            <label for="auth_cache_ttl">Cache TTL</label>
            <div class="input-wrapper">
              <input type="number" id="auth_cache_ttl" name="local_auth_cache_ttl_seconds" min="0" value="{{ (configuration.get('auth') or {}).get('local_auth_cache_ttl_seconds','') }}" />
              <span class="field-hint">Cache TTL (seconds)</span>
            </div>
          </div>
          <div class="form-field">
            <label for="auth_backend_timeout">Backend Timeout</label>
            <div class="input-wrapper">
              <input type="number" step="0.1" id="auth_backend_timeout" name="backend_timeout" min="0.1" value="{{ (configuration.get('auth') or {}).get('backend_timeout','') }}" />
              <span class="field-hint">Timeout (seconds)</span>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="btn-group">
      <button class="btn" onclick="saveAuthSettings()">Save Auth Settings</button>
      <span id="auth-status" class="status-message"></span>
    </div>
  </div>
  
  <!-- LDAP Backend -->
  <div class="subsection">
    <div class="subsection-header">LDAP Backend</div>
    <form id="ldap-form" onsubmit="return false;" class="form-grid">
      <div class="form-field">
        <label for="ldap_server">Server</label>
        <div class="input-wrapper">
          <input type="text" id="ldap_server" name="server" value="{{ (configuration.get('ldap') or {}).get('server','') }}" />
          <span class="field-hint">LDAP URL</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_base_dn">Base DN</label>
        <div class="input-wrapper">
          <input type="text" id="ldap_base_dn" name="base_dn" value="{{ (configuration.get('ldap') or {}).get('base_dn','') }}" />
          <span class="field-hint">Base DN</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_user_attribute">User Attribute</label>
        <div class="input-wrapper">
          <input type="text" id="ldap_user_attribute" name="user_attribute" value="{{ (configuration.get('ldap') or {}).get('user_attribute','') }}" />
          <span class="field-hint">Search attribute</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_bind_dn">Bind DN</label>
        <div class="input-wrapper">
          <input type="text" id="ldap_bind_dn" name="bind_dn" value="{{ (configuration.get('ldap') or {}).get('bind_dn','') }}" />
          <span class="field-hint">Bind DN (optional)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_bind_password">Bind Password</label>
        <div class="input-wrapper">
          <input type="password" id="ldap_bind_password" name="bind_password" value="{{ (configuration.get('ldap') or {}).get('bind_password','') }}" />
          <span class="field-hint">Password (optional)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_use_tls">Use TLS</label>
        <div class="input-wrapper">
          <select id="ldap_use_tls" name="use_tls">
            {% set use_tls = ((configuration.get('ldap') or {}).get('use_tls','false') | string).lower() %}
            <option value="false" {% if use_tls=='false' %}selected{% endif %}>No</option>
            <option value="true" {% if use_tls=='true' %}selected{% endif %}>Yes</option>
          </select>
          <span class="field-hint">Use TLS</span>
        </div>
      </div>
      <div class="form-field">
        <label for="ldap_timeout">Timeout</label>
        <div class="input-wrapper">
          <input type="number" id="ldap_timeout" name="timeout" min="1" value="{{ (configuration.get('ldap') or {}).get('timeout','') }}" />
          <span class="field-hint">Timeout (seconds)</span>
        </div>
      </div>
    </form>
    <div class="btn-group">
      <button class="btn" onclick="saveLdapSettings()">Save LDAP Settings</button>
      <span id="ldap-status" class="status-message"></span>
    </div>
  </div>

  <!-- Okta Backend -->
  <div class="subsection">
    <div class="subsection-header">Okta Backend</div>
    <form id="okta-form" onsubmit="return false;" class="form-grid">
      <div class="form-field">
        <label for="okta_domain">Domain</label>
        <div class="input-wrapper">
          <input type="text" id="okta_domain" name="domain" value="{{ (configuration.get('okta') or {}).get('domain','') }}" />
          <span class="field-hint">Okta domain</span>
        </div>
      </div>
      <div class="form-field">
        <label for="okta_api_token">API Token</label>
        <div class="input-wrapper">
          <input type="password" id="okta_api_token" name="api_token" value="{{ (configuration.get('okta') or {}).get('api_token','') }}" />
          <span class="field-hint">API token</span>
        </div>
      </div>
      <div class="form-field">
        <label for="okta_timeout">Timeout</label>
        <div class="input-wrapper">
          <input type="number" id="okta_timeout" name="timeout" min="1" value="{{ (configuration.get('okta') or {}).get('timeout','') }}" />
          <span class="field-hint">Timeout (seconds)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="okta_default_okta_group">Default Okta Group (ID)</label>
        <div class="input-wrapper">
          <input type="text" id="okta_default_okta_group" name="default_okta_group" value="{{ (configuration.get('okta') or {}).get('default_okta_group','') }}" />
          <span class="field-hint">Enter Okta group ID. On startup, server creates local group 'okta-default-group', maps to this Okta group, and links it to the default device group.</span>
        </div>
      </div>
    </form>
    <div class="btn-group">
      <button class="btn" onclick="saveOktaSettings()">Save Okta Settings</button>
      <span id="okta-status" class="status-message"></span>
    </div>
  </div>

  <!-- RADIUS Auth Backend (client) -->
  <div class="subsection">
    <div class="subsection-header">RADIUS Auth Backend</div>
    <form id="radius-auth-form" onsubmit="return false;" class="form-grid">
      <div class="form-field">
        <label for="radius_auth_server">Server</label>
        <div class="input-wrapper">
          <input type="text" id="radius_auth_server" name="radius_server" value="{{ (configuration.get('radius_auth') or {}).get('radius_server','') }}" />
          <span class="field-hint">RADIUS server host or IP</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_port">Port</label>
        <div class="input-wrapper">
          <input type="number" id="radius_auth_port" name="radius_port" min="1" max="65535" value="{{ (configuration.get('radius_auth') or {}).get('radius_port','1812') }}" />
          <span class="field-hint">Auth port (default 1812)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_secret">Shared Secret</label>
        <div class="input-wrapper">
          <input type="password" id="radius_auth_secret" name="radius_secret" value="{{ (configuration.get('radius_auth') or {}).get('radius_secret','') }}" />
          <span class="field-hint">Minimum 8 characters</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_timeout">Timeout</label>
        <div class="input-wrapper">
          <input type="number" id="radius_auth_timeout" name="radius_timeout" min="1" max="60" value="{{ (configuration.get('radius_auth') or {}).get('radius_timeout','5') }}" />
          <span class="field-hint">Seconds (default 5)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_retries">Retries</label>
        <div class="input-wrapper">
          <input type="number" id="radius_auth_retries" name="radius_retries" min="0" max="10" value="{{ (configuration.get('radius_auth') or {}).get('radius_retries','3') }}" />
          <span class="field-hint">Retry attempts (default 3)</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_nas_ip">NAS IP</label>
        <div class="input-wrapper">
          <input type="text" id="radius_auth_nas_ip" name="radius_nas_ip" value="{{ (configuration.get('radius_auth') or {}).get('radius_nas_ip','0.0.0.0') }}" />
          <span class="field-hint">NAS-IP-Address attribute</span>
        </div>
      </div>
      <div class="form-field">
        <label for="radius_auth_nas_identifier">NAS Identifier</label>
        <div class="input-wrapper">
          <input type="text" id="radius_auth_nas_identifier" name="radius_nas_identifier" value="{{ (configuration.get('radius_auth') or {}).get('radius_nas_identifier','') }}" />
          <span class="field-hint">NAS-Identifier attribute (optional)</span>
        </div>
      </div>
    </form>
    <div class="btn-group">
      <button class="btn" onclick="saveRadiusAuthBackendSettings()">Save RADIUS Auth Backend</button>
      <span id="radius-auth-status" class="status-message"></span>
    </div>
  </div>
</div>
