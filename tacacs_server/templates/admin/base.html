<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title or "Admin" }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f3f4f6; color: #111827; }
        header { background: #1f2937; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        header a { color: #d1d5db; text-decoration: none; margin-left: 1rem; }
        main { padding: 2rem; }
        .card { background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 6px rgba(15,23,42,0.12); }
        .stat-card { background:#1f2937; color:white; border-radius:8px; padding:1rem 1.5rem; min-width:140px; flex:1 1 140px; box-shadow:0 6px 16px rgba(17,24,39,0.2); }
        .stat-value { font-size:2rem; font-weight:600; }
        .stat-label { text-transform:uppercase; font-size:0.75rem; letter-spacing:0.08em; color:#d1d5db; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f9fafb; font-weight: 600; }
        .btn { display: inline-block; padding: 0.5rem 1rem; border-radius: 4px; background: #2563eb; color: white; text-decoration: none; border: none; cursor: pointer; }
        .btn-secondary { background: #6b7280; }
        form.inline { display: inline; }
        .alert { background: #fee2e2; color: #b91c1c; padding: 0.75rem 1rem; border-radius: 4px; margin-bottom: 1rem; }
        .modal-backdrop { display:none; position:fixed; inset:0; background:rgba(15,23,42,0.6); align-items:center; justify-content:center; z-index:1000; }
        .modal-card { background:white; border-radius:8px; padding:1.5rem; width:min(460px, 90vw); box-shadow:0 20px 35px rgba(15,23,42,0.25); }
        .modal-title { margin-top:0; margin-bottom:1rem; color:#111827; }
        .modal-form { display:flex; flex-direction:column; gap:0.75rem; }
        .modal-field { display:flex; flex-direction:column; gap:0.35rem; color:#374151; }
        .modal-field input,
        .modal-field textarea,
        .modal-field select { padding:0.55rem 0.75rem; border-radius:6px; border:1px solid #d1d5db; font-size:0.95rem; }
        .modal-field textarea { resize:vertical; min-height:90px; }
        .modal-hint { font-size:0.8rem; color:#6b7280; }
        .modal-actions { display:flex; gap:0.75rem; justify-content:flex-end; margin-top:0.5rem; }

        /* Toast styles */
        .toast-container { position: fixed; right: 16px; bottom: 16px; display: flex; flex-direction: column; gap: 8px; z-index: 2000; }
        .toast { min-width: 200px; max-width: 420px; background: #10b981; color: #062b20; padding: 10px 12px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); border: 1px solid #34d399; opacity: 0; transform: translateY(8px); transition: opacity 180ms ease, transform 180ms ease; font-size: 0.95rem; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.error { background: #fee2e2; color: #7f1d1d; border-color: #fecaca; }
        .toast.info { background: #dbeafe; color: #1e3a8a; border-color: #bfdbfe; }

        /* Subtle fade utility for inline status labels */
        .fade-inline { transition: opacity 400ms ease; opacity: 1; }
    </style>
</head>
<body>
<header>
    <div>
        <strong>TACACS+ Admin</strong>
        <span style="
            display:inline-block;
            margin-left:10px;
            padding:2px 8px;
            border-radius:999px;
            font-size:12px;
            background:{% if api_disabled %}#fee2e2{% else %}#dcfce7{% endif %};
            color:{% if api_disabled %}#991b1b{% else %}#166534{% endif %};
            border:1px solid {% if api_disabled %}#fecaca{% else %}#bbf7d0{% endif %};
        "
        title="{% if api_disabled %}API disabled (set API_TOKEN){% else %}API enabled (token required){% endif %}">
            API: {% if api_disabled %}disabled{% else %}enabled{% endif %}
        </span>
    </div>
    <nav>
        <a href="/admin/">Dashboard</a>
        <a href="/admin/devices">Devices</a>
        <a href="/admin/groups">Device Groups</a>
        <a href="/admin/user-groups">User Groups</a>
        <a href="/admin/users">Users</a>
        <a href="/admin/config">Configuration</a>
        <a href="/admin/webhooks">Webhooks</a>
        <a href="/admin/command-authorization">Command Auth</a>
        <a href="#" onclick="logout(event)">Logout</a>
    </nav>
</header>
<main>
    <div id="api-warning" style="{% if api_disabled %}display:block{% else %}display:none{% endif %};background:#fff3cd;color:#664d03;border:1px solid #ffecb5;padding:10px;border-radius:6px;margin:10px 0;">
        <strong>API disabled or unauthorized:</strong> Configure <code>API_TOKEN</code> and include the API token header for direct API calls. The admin UI remains functional.
    </div>
    {% if message %}
    <div class="alert">{{ message }}</div>
    {% endif %}
    {% block content %}{% endblock %}
</main>
<div id="toast-root" class="toast-container" aria-live="polite" aria-atomic="true"></div>
<script>
async function logout(event) {
    event.preventDefault();
    await fetch('/admin/logout', {method: 'POST', headers: {'Accept': 'application/json'}});
    window.location.href = '/admin/login';
}
// Detect API availability and auth; show banner if disabled/unauthorized
(async function(){
    try {
        const r = await fetch('/api/status');
        if (!r.ok) {
            document.getElementById('api-warning').style.display = 'block';
        }
    } catch(e){
        document.getElementById('api-warning').style.display = 'block';
    }
})();

// Toast helper
function showToast(message, type = 'success', ms = 2400) {
    const root = document.getElementById('toast-root');
    if (!root) return;
    const el = document.createElement('div');
    el.className = 'toast ' + (type || 'success');
    el.textContent = message || '';
    root.appendChild(el);
    // async show then auto-remove
    requestAnimationFrame(() => el.classList.add('show'));
    const remove = () => {
        el.classList.remove('show');
        el.addEventListener('transitionend', () => el.remove(), { once: true });
    };
    const t = setTimeout(remove, Math.max(1200, ms|0));
    el.addEventListener('click', () => { clearTimeout(t); remove(); });
}

// Inline status fade helper
function flashStatus(el, text, type = 'success', ms = 2200) {
    if (!el) return;
    // Ensure it can fade
    el.classList.add('fade-inline');
    el.style.opacity = '1';
    if (type === 'error') {
        el.style.color = '#ef4444';
    } else if (type === 'info') {
        el.style.color = '#2563eb';
    } else {
        el.style.color = '#10b981';
    }
    el.textContent = text || '';
    if (type !== 'error') {
        // Auto fade and clear for non-errors
        setTimeout(() => {
            el.style.opacity = '0';
            el.addEventListener('transitionend', () => { el.textContent = ''; el.style.opacity = '1'; }, { once: true });
        }, Math.max(1000, ms|0));
    }
}
</script>
</body>
</html>
